# Architecture

# Mind Measure System Architecture

## Overview

Mind Measure is built on a modern, cloud-native architecture using AWS services to provide a scalable, secure, and compliant mental health monitoring platform for educational institutions.

## System Architecture

### High-Level Architecture

```
 
 Mobile App Admin Portal Documentation
 (Capacitor/iOS) (React/Vercel) (Static Site)
 
 
 
 
 
 Vercel API
 (Serverless Functions)
 
 
 
 AWS Cognito
 (Authentication)
 
 
 
 Aurora Serverless
 (PostgreSQL)
 
 
 
 Assessment Engine API Gateway
 (ej3hig3gwl.execute-api.eu-west-2...)
 
 
 
 Step Functions State Machine
 (Orchestrates Parallel Analysis)
 
 
 
 
 
 Audio Analysis Visual Text
 Lambda Analysis Analysis
 (23 features) Lambda Lambda
 (18 feat.) (16 feat.)
 
 
 
 
 
 Fusion Engine Lambda
 (Mind Measure Score 0-100)
 
 
 
 Aurora (assessment_engine schema)
 S3 (mindmeasure-checkin-media-staging)
 
 
 
```

### Core Components

#### **Frontend Applications**

**Mobile Application**
- **Technology**: React + Capacitor + TypeScript
- **Deployment**: iOS App Store, Android Play Store
- **Domain**: mobile.mindmeasure.app
- **Features**: Student assessments, dashboard, buddy system

**Admin Portal**
- **Technology**: React + Vite + TypeScript
- **Deployment**: Vercel
- **Domain**: admin.mindmeasure.co.uk
- **Features**: University management, analytics, CMS

**Documentation Site**
- **Technology**: Static site generator
- **Deployment**: Vercel
- **Domain**: docs.mindmeasure.co.uk
- **Features**: Technical documentation, API reference

#### **Authentication & Authorisation**

**AWS Cognito User Pools**
- **User Pool ID**: `eu-west-2_ClAG4fQXR`
- **Client ID**: `7vu03ppv6alkpphs1ksopll8us`
- **Region**: `eu-west-2` (London)
- **Features**:
 - Multi-factor authentication
 - Password policies
 - Email verification
 - JWT token generation

**Authentication Flow**
```typescript
// Mobile App Authentication
const { signIn } = useAuth();
const result = await signIn(email, password);

// JWT Token for API calls
const session = await fetchAuthSession();
const token = session.tokens?.accessToken?.toString();
```

#### **API Layer**

**Vercel API Functions** (Mobile App)
- **Base URL**: `https://mobile.mindmeasure.app/api`
- **Endpoints**: `/api/database/*`, `/api/storage/*`, `/api/auth/*`
- **Authentication**: Cognito JWT tokens
- **Deployment**: Vercel serverless functions

**Assessment Engine API Gateway** (Multimodal Assessment)
- **Base URL**: `https://ej3hig3gwl.execute-api.eu-west-2.amazonaws.com/v1/`
- **Endpoints**: `/checkins/start`, `/checkins/{id}/complete`, `/checkins/{id}`
- **Authentication**: Cognito JWT tokens (same user pool)
- **Deployment**: AWS CDK (deployed November 28, 2025)

**Lambda Functions**

**Assessment Engine Lambdas** (Deployed Nov 28, 2025)
```yaml
CheckInStartLambda:
 Runtime: Node.js 20.x
 Memory: 512 MB
 Timeout: 30 seconds
 Purpose: Create check-in, generate S3 upload URLs

AudioAnalysisLambda:
 Runtime: Node.js 20.x
 Memory: 2048 MB
 Timeout: 60 seconds
 Purpose: Extract 23 audio features (prosody, speech dynamics)

VisualAnalysisLambda:
 Runtime: Node.js 20.x
 Memory: 3008 MB
 Timeout: 90 seconds
 Purpose: Extract 18 visual features (emotion, expression, gaze)

TextAnalysisLambda:
 Runtime: Node.js 20.x
 Memory: 1024 MB
 Timeout: 30 seconds
 Purpose: Extract 16 text features (sentiment, cognitive load)

FusionEngineLambda:
 Runtime: Node.js 20.x
 Memory: 1024 MB
 Timeout: 30 seconds
 Purpose: Multimodal fusion scoring (0-100 Mind Measure Score)
```

**Step Functions State Machine**
- **Purpose**: Orchestrates parallel analysis → fusion → baseline update
- **Timeout**: 5 minutes
- **Retries**: Automatic with exponential backoff

**Vercel API Functions**
```yaml
Database Operations:
 - POST /api/database/select
 - POST /api/database/insert
 - POST /api/database/update
 - POST /api/database/delete

Storage Operations:
 - POST /api/storage/upload
 - GET /api/storage/download
 - DELETE /api/storage/delete

Authentication:
 - POST /api/auth/signin
 - POST /api/auth/signup
 - POST /api/auth/refresh
```

#### **Data Layer**

**Amazon Aurora Serverless v{2}**
- **Engine**: PostgreSQL 15.4
- **Cluster**: `mindmeasure-aurora.cluster-cz8c8wq4k3ak.eu-west-2.rds.amazonaws.com`
- **Region**: `eu-west-2` (London)
- **Scaling**: 0.5 - 16 ACUs (Auto-scaling)
- **Features**:
 - Automatic scaling
 - Point-in-time recovery
 - Encrypted at rest
 - Multi-AZ deployment

**Connection Architecture**
```typescript
// Server-side connection
const pool = new Pool({
 host: 'mindmeasure-aurora.cluster-cz8c8wq4k3ak.eu-west-2.rds.amazonaws.com',
 port: 5432,
 database: 'mindmeasure',
 user: 'mindmeasure_admin',
 password: process.env.RDS_PASSWORD,
 ssl: { rejectUnauthorized: false },
 max: 20,
 idleTimeoutMillis: 30000
});

// Browser-side API calls
const response = await fetch('/api/database/select', {
 method: 'POST',
 headers: { 'Content-Type': 'application/json' },
 body: JSON.stringify({ table: 'profiles', filters: { user_id } })
});
```

#### **Storage Layer**

**Amazon S3**
- **Bucket Structure**: `mindmeasure-{university-id}-assets`
- **Regions**: `eu-west-2` (London)
- **Encryption**: AES-256 (SSE-S3)
- **Access**: Private with signed URLs

**File Upload Flow**
```typescript
// Client-side upload
const formData = new FormData();
formData.append('file', file);
formData.append('university_id', universityId);

const response = await fetch('/api/storage/upload', {
 method: 'POST',
 body: formData
});
```

#### **AI/ML Services**

**AWS Rekognition**
- **Purpose**: Facial emotion analysis
- **Features**: Emotion detection, face analysis
- **Integration**: Lambda function calls

**ElevenLabs Integration**
- **Purpose**: Conversational AI for assessments
- **Agent ID**: `agent_9301k22s8e94f7qs5e704ez02npe`
- **Features**: Voice-to-text, conversation management

**Custom AI Pipeline**
```typescript
// Multi-modal analysis flow
const analysisResults = await Promise.allSettled([
 analyzeAudio(sessionId, audioData),
 analyzeVisual(sessionId, imageData),
 analyzeText(sessionId, transcriptData)
]);

const fusionScore = await calculateMindMeasure(sessionId);
```

## Data Flow Architecture

### Assessment Data Pipeline

**Legacy Pipeline** (Baseline Assessments)
```
Student Assessment → ElevenLabs Widget → Conversation Data
 ↓
 Session Creation (Database)
 ↓
 Parallel Analysis → Fusion → Score Storage
```

**Assessment Engine Pipeline** (Daily Check-ins - Deployed Nov 28, 2025)
```
Mobile App → POST /v1/checkins/start → Get S3 Upload URLs
 ↓
Upload Audio + Images to S3
 ↓
POST /v1/checkins/{id}/complete → Start Step Functions
 ↓

 Step Functions State Machine (Parallel Execution)
 
 
 Audio Visual Text
 Analysis Analysis Analysis
 Lambda Lambda Lambda
 (23 features) (18 features) (16 features)
 
 
 
 ↓
 Fusion Engine Lambda
 (Mind Measure Score 0-100)
 ↓
 Baseline Update (if needed)
 ↓
 Mark Complete

 ↓
GET /v1/checkins/{id} → Return Score + Modality Breakdown
 ↓
Display in Mobile App Dashboard
```

**Database Storage**
- **Legacy**: `public` schema (assessment_sessions, fusion_outputs, etc.)
- **Assessment Engine**: `assessment_engine` schema (check_ins, audio_analysis, visual_analysis, text_analysis, fusion_results, user_baselines)

### University Data Flow

```
University Admin → CMS Interface → API Gateway → Lambda Functions
 ↓
 Aurora Database
 ↓
 Student Dashboard
```

## Security Architecture

### Network Security

**VPC Configuration**
- **Private Subnets**: Lambda functions, RDS
- **Public Subnets**: NAT Gateway, Load Balancer
- **Security Groups**: Restrictive rules
- **NACLs**: Network-level access control

**WAF (Web Application Firewall)**
- **OWASP Top 10 Protection**
- **Rate Limiting**
- **Geographic Restrictions**
- **SQL Injection Prevention**

### Data Security

**Encryption at Rest**
- **Database**: AES-256 encryption
- **S3 Storage**: SSE-S3 encryption
- **Lambda Environment**: KMS encryption

**Encryption in Transit**
- **TLS 1.3**: All communications
- **Certificate Pinning**: Mobile apps
- **HTTPS Everywhere**: All endpoints

### Identity Security

**Multi-Factor Authentication**
- **Available for**: Admin users
- **Methods**: SMS, TOTP, Email
- **Enforcement**: Configurable per user pool

**JWT Token Security**
- **Expiration**: 1 hour access tokens
- **Refresh**: 30-day refresh tokens
- **Validation**: Every API request
- **Revocation**: Immediate logout capability

## Scalability & Performance

### Auto-Scaling Components

**Aurora Serverless v{2}**
- **Scaling Range**: 0.5 - 16 ACUs
- **Scale Up**: Seconds
- **Scale Down**: Minutes
- **Cost**: Pay per use

**Lambda Functions**
- **Concurrent Executions**: 1000 (configurable)
- **Cold Start**: &lt;2 seconds
- **Auto-scaling**: Automatic
- **Cost**: Pay per invocation

### Performance Optimisation

**Database Optimisation**
- **Connection Pooling**: PgBouncer
- **Read Replicas**: Available
- **Indexing**: Optimized queries
- **Caching**: Application-level

**CDN & Caching**
- **CloudFront**: Global distribution
- **Edge Caching**: Static assets
- **API Caching**: Configurable
- **Browser Caching**: Optimized headers

## Monitoring & Observability

### CloudWatch Integration

**Metrics Collected**
- **Database**: CPU, connections, queries
- **Lambda**: Invocations, duration, errors
- **API Gateway**: Requests, latency, errors
- **Application**: Custom business metrics

**Alerting**
- **Database**: High CPU, connection limits
- **Lambda**: Error rates, timeouts
- **API**: High latency, error rates
- **Security**: Failed authentication attempts

### Logging Strategy

**Log Aggregation**
- **Application Logs**: CloudWatch Logs
- **Database Logs**: Aurora logs
- **Security Logs**: CloudTrail
- **Performance Logs**: X-Ray tracing

**Log Retention**
- **Operational**: 30 days
- **Security**: 1 year
- **Compliance**: 7 years
- **Debug**: 7 days

## Disaster Recovery

### Backup Strategy

**Database Backups**
- **Automated**: Daily backups
- **Retention**: 35 days
- **Point-in-time**: 5-minute granularity
- **Cross-region**: Enabled

**Application Backups**
- **Code**: Git repositories
- **Infrastructure**: CloudFormation templates
- **Configuration**: Environment variables
- **Data**: S3 cross-region replication

### Recovery Procedures

**RTO (Recovery Time Objective)**
- **Database**: &lt; 4 hours
- **Application**: &lt; 2 hours
- **Full Service**: &lt; 6 hours

**RPO (Recovery Point Objective)**
- **Database**: &lt; 15 minutes
- **Files**: &lt; 1 hour
- **Configuration**: &lt; 5 minutes

## Deployment Architecture

### CI/CD Pipeline

**Frontend Deployment**
```yaml
GitHub → Vercel Build → Production Deployment
 ↓
 Automatic Testing → Preview Deployments
```

**Backend Deployment**
```yaml
GitHub → AWS CodeBuild → Lambda Deployment
 ↓
 Unit Tests → Integration Tests → Production
```

### Environment Management

**Environments**
- **Development**: Local development
- **Staging**: Pre-production testing
- **Production**: Live system

**Configuration Management**
- **Environment Variables**: Vercel/AWS
- **Secrets**: AWS Secrets Manager
- **Feature Flags**: Application-level
- **Database Migrations**: Automated

## Cost Optimisation

### Resource Optimisation

**Aurora Serverless v{2}**
- **Auto-pause**: 5 minutes inactivity
- **Scaling**: Based on demand
- **Reserved Capacity**: For predictable workloads

**Lambda Functions**
- **Memory Optimisation**: Right-sized
- **Timeout Optimisation**: Minimal values
- **Provisioned Concurrency**: Critical functions only

### Cost Monitoring

**Billing Alerts**
- **Monthly Budgets**: Per service
- **Anomaly Detection**: Unusual spending
- **Cost Allocation**: Per university
- **Optimisation Reports**: Monthly reviews

## Technology Stack Summary

### Frontend
- **React 18**: UI framework
- **TypeScript**: Type safety
- **Vite**: Build tool
- **Capacitor**: Mobile deployment
- **Tailwind CSS**: Styling

### Backend
- **Node.js 18**: Runtime
- **PostgreSQL 15**: Database
- **AWS Lambda**: Serverless functions
- **API Gateway**: API management
- **Cognito**: Authentication

### Infrastructure
- **AWS**: Cloud provider
- **Vercel**: Frontend hosting
- **CloudFormation**: Infrastructure as code
- **GitHub Actions**: CI/CD
- **CloudWatch**: Monitoring

### Security & Compliance
- **HIPAA**: Healthcare compliance
- **GDPR**: Privacy compliance
- **SOC 2**: Security standards
- **AWS BAA**: Business associate agreement

---

This architecture provides a robust, scalable, and compliant foundation for the Mind Measure platform, supporting multiple universities while maintaining strict security and privacy standards.

**Last Updated**: November 28, 2025
**Version**: 2.1 (Assessment Engine Added)
**Next Review**: December 28, 2025
