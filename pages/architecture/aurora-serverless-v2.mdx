# Aurora Serverless v2 Database Documentation

## Overview

Mind Measure uses Aurora Serverless v2 PostgreSQL as its primary production database, providing medical-grade security, performance, and reliability for healthcare applications.

## Current Configuration

### Production Database
- **Cluster Endpoint**: mindmeasure-aurora.cluster-cz8c8wq4k3ak.eu-west-2.rds.amazonaws.com
- **Read Replica Endpoint**: mindmeasure-aurora.cluster-ro-cz8c8wq4k3ak.eu-west-2.rds.amazonaws.com
- **Engine**: Aurora PostgreSQL 15.4
- **Region**: eu-west-2 (London)
- **Auto-scaling**: 0.5 to 16 ACUs (Aurora Capacity Units)

### Performance Specifications
- **Uptime SLA**: 99.99%
- **Performance**: 3x faster than standard PostgreSQL
- **Scaling**: Automatic based on demand
- **Failover**: Less than 30 seconds
- **Backup Retention**: 35 days
- **Multi-AZ**: Yes (3 availability zones)

## Security Features

### Encryption
- **At Rest**: AWS KMS encryption enabled
- **In Transit**: SSL/TLS connections enforced
- **Key Management**: AWS KMS with customer-managed keys

### Network Security
- **VPC Isolation**: Database isolated in private subnets
- **Security Groups**: Restrictive access controls
- **Public Access**: Controlled via security groups

### Compliance
- **HIPAA Eligible**: AWS Aurora is HIPAA compliant
- **SOC 2 Type II**: Enterprise audit standards
- **GDPR Compliant**: EU data residency (London region)
- **Audit Logging**: Comprehensive activity tracking

## Monitoring and Observability

### CloudWatch Integration
- **Logs**: PostgreSQL logs exported to CloudWatch
- **Metrics**: Real-time performance metrics
- **Alarms**: Automated alerting for issues

### Performance Insights
- **Retention**: 7 days of performance data
- **Query Analysis**: Identify slow queries
- **Resource Utilization**: CPU, memory, I/O monitoring

## Auto-scaling Configuration

### Capacity Units (ACUs)
- **Minimum**: 0.5 ACUs (1 GB RAM, 2 vCPUs)
- **Maximum**: 16 ACUs (32 GB RAM, 64 vCPUs)
- **Scaling**: Automatic based on workload

### Scaling Behavior
- **Scale Up**: Responds to increased demand within seconds
- **Scale Down**: Gradual reduction when demand decreases
- **Cost Optimisation**: Pay only for resources used

## Connection Management

### Environment Variables
```bash
# Production Configuration
VITE_DB_HOST=mindmeasure-aurora.cluster-cz8c8wq4k3ak.eu-west-2.rds.amazonaws.com
VITE_DB_PORT=5432
VITE_DB_NAME=mindmeasure
VITE_DB_USERNAME=mindmeasure_admin
VITE_DB_PASSWORD=MindMeasure2024!
```

### Connection Pooling
Aurora provides built-in connection pooling to optimise database connections and improve performance.

### SSL Configuration
```javascript
const dbConfig = {
  host: process.env.AWS_RDS_HOST,
  port: 5432,
  database: 'mindmeasure',
  user: 'mindmeasure_admin',
  password: process.env.AWS_RDS_PASSWORD,
  ssl: {
    rejectUnauthorized: false
  }
};
```

## Backup and Recovery

### Automated Backups
- **Frequency**: Continuous backup to S3
- **Retention**: 35 days
- **Point-in-time Recovery**: Any second within retention period

### Manual Snapshots
- **On-demand**: Manual snapshots for major changes
- **Cross-region**: Can be copied to other regions
- **Encryption**: Snapshots are encrypted

## Cost Management

### Pricing Model
- **Compute**: $0.12 per ACU per hour
- **Storage**: $0.10 per GB per month
- **I/O**: $0.20 per million requests
- **Backup**: $0.021 per GB per month

### Current Costs (Estimated)
- **Monthly**: Approximately $89/month
- **Annual**: Approximately $1,068/year
- **Scaling**: Costs adjust automatically with usage

## Health Monitoring

### Health Check Endpoint
```bash
curl https://mind-measure-core-9751wrcsi-mindmeasure.vercel.app/api/database/health
```

### Expected Response
```json
{
  "status": "healthy",
  "database": {
    "version": "PostgreSQL 15.4 on aarch64-unknown-linux-gnu",
    "current_time": "2025-09-23T15:27:38.980Z",
    "host": "mindmeasure-aurora.cluster-cz8c8wq4k3ak.eu-west-2.rds.amazonaws.com",
    "database": "mindmeasure"
  },
  "timestamp": "2025-09-23T15:27:39.027Z"
}
```

## Migration History

### From RDS to Aurora (September 2025)
- **Previous**: RDS PostgreSQL t3.micro
- **Current**: Aurora Serverless v2
- **Migration Method**: pg_dump and pg_restore
- **Downtime**: Less than 5 minutes
- **Data Integrity**: 100% preserved

## Troubleshooting

### Common Issues

#### Connection Timeouts
- Check security group rules
- Verify VPC configuration
- Confirm SSL settings

#### Performance Issues
- Monitor ACU usage in CloudWatch
- Check for long-running queries
- Review Performance Insights

#### Scaling Issues
- Verify auto-scaling configuration
- Check ACU limits
- Monitor scaling events

### Diagnostic Commands
```bash
# Test connection
psql -h mindmeasure-aurora.cluster-cz8c8wq4k3ak.eu-west-2.rds.amazonaws.com -U mindmeasure_admin -d mindmeasure

# Check cluster status
aws rds describe-db-clusters --db-cluster-identifier mindmeasure-aurora

# View performance metrics
aws cloudwatch get-metric-statistics --namespace AWS/RDS --metric-name CPUUtilization
```

## Best Practices

### Performance Optimisation
- Use read replicas for read-heavy workloads
- Implement connection pooling
- Optimise queries for Aurora architecture
- Monitor and tune auto-scaling parameters

### Security Hardening
- Rotate passwords regularly
- Use IAM database authentication when possible
- Enable VPC Flow Logs
- Regular security audits

### Cost Optimisation
- Monitor ACU usage patterns
- Set appropriate min/max ACU limits
- Use reserved capacity for predictable workloads
- Regular cost reviews

## Future Considerations

### Scaling Options
- **Read Replicas**: Add for read-heavy workloads
- **Cross-Region**: Disaster recovery setup
- **Global Database**: Multi-region deployment

### Advanced Features
- **Aurora Machine Learning**: ML integration
- **Data API**: HTTP-based database access
- **Parallel Query**: Enhanced analytics performance

This Aurora Serverless v2 setup provides enterprise-grade database infrastructure suitable for healthcare applications requiring high availability, security, and compliance.
