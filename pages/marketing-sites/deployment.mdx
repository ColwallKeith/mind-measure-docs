# Deployment Guide

## Overview

Each marketing site deploys independently to Vercel with its own domain and build configuration.

## Deployment Architecture

### Vercel Projects

| Site | Vercel Project | Domain | Status |
|------|---------------|--------|--------|
| University | `mindmeasure-uni` | mindmeasure.co.uk | Live |
| Student | `mindmeasure-student` | mindmeasure.app | Live |
| Marketing CMS | `mind-measure-marketing-cms` | marketing.mindmeasure.co.uk | Live |
| Buddy Pages | `mind-measure-buddy` | buddy.mindmeasure.app | Live |
| Workplace/Pro | TBD | TBD | 2026 |

### Why Separate Projects?

- **Independent deployments** – Deploy one site without affecting others
- **Site-specific configuration** – Different environment variables
- **Isolated analytics** – Separate performance monitoring

## Deployment Process

### Marketing Sites

```bash
# University site
cd mindmeasure-marketing/sites/university  # or Figma Sites output
npm run build
npx vercel --prod

# Student site
cd mindmeasure-marketing/sites/student  # or Figma Sites output
npm run build
npx vercel --prod
```

### Marketing CMS

```bash
cd mind-measure-marketing-cms
npx vercel --prod
```

### Buddy Pages

```bash
cd mind-measure-buddy
npm run build
npx vercel --prod
```

## Environment Variables

### Marketing Sites

```env
# Marketing CMS API (for blog content)
MARKETING_CMS_API_URL=https://marketing.mindmeasure.co.uk

# Contact Forms (when implemented)
RESEND_API_KEY=re_xxx
CONTACT_EMAIL=hello@mindmeasure.co.uk

# Analytics (optional)
GOOGLE_ANALYTICS_ID=G-xxx
```

### Marketing CMS

```env
# Database
DATABASE_URL=postgresql://...

# AWS (S3 for media)
AWS_REGION=eu-west-2
AWS_ACCESS_KEY_ID=xxx
AWS_SECRET_ACCESS_KEY=xxx
AWS_S3_BUCKET_NAME=xxx
```

### Buddy Pages

No environment variables required – API calls go to `mobile.mindmeasure.app`.

## Domain Configuration

### DNS Records (Cloudflare)

All records should be **DNS only (grey cloud)** so Vercel handles SSL.

```dns
# University Site (mindmeasure.co.uk)
Type: A
Name: @
Value: 76.76.21.21

Type: CNAME
Name: www
Value: cname.vercel-dns.com

# Student Site (mindmeasure.app)
Type: CNAME
Name: @
Value: cname.vercel-dns.com

Type: CNAME
Name: www
Value: cname.vercel-dns.com

# Marketing CMS (marketing.mindmeasure.co.uk)
Type: CNAME
Name: marketing
Value: cname.vercel-dns.com

# Buddy Pages (buddy.mindmeasure.app)
Type: A
Name: buddy
Value: 76.76.21.21
```

## Build Configuration

### React Sites (from Figma Make)

```
Framework Preset: Vite (or Next.js)
Build Command: npm run build
Output Directory: dist (or .next)
Install Command: npm install
Node Version: 20.x
```

### Marketing CMS (Next.js)

```
Framework Preset: Next.js
Build Command: npm run build
Output Directory: .next
Install Command: npm install
Node Version: 20.x
```

## Rollback

### Via CLI

```bash
# List recent deployments
npx vercel ls --prod

# Promote a previous deployment
npx vercel promote [previous-deployment-url]
```

### Via Dashboard

1. Go to Vercel project → Deployments
2. Find last working deployment
3. Click three dots → "Promote to Production"

## Deployment Checklist

### Before Deploying

- [ ] Test build locally (`npm run build`)
- [ ] Check for TypeScript errors
- [ ] Verify environment variables set in Vercel
- [ ] Commit changes with descriptive message

### After Deploying

- [ ] Visit production URL
- [ ] Test critical pages (home, blog, contact)
- [ ] Check browser console for errors
- [ ] Verify images load correctly
- [ ] Test mobile responsiveness

## Deprecated: Sanity Environment Variables

The following Sanity variables are no longer required for marketing sites and can be removed from Vercel:

```env
# REMOVE THESE
PUBLIC_SANITY_PROJECT_ID=xxx
PUBLIC_SANITY_DATASET=xxx
SANITY_API_TOKEN=xxx
SANITY_API_READ_TOKEN=xxx
```

---

**Last Updated:** January 2026
